<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>WebSocketClient</title>
    <style>
        button {
            margin: 10px 0;
        }
    </style>
    <script type="text/javascript" src="WebSocketClient.js"></script>
</head>
<body style="margin: 0; padding: 0;">
<div style="display: flex; justify-content: center; align-items: center; width: 100vw; height: 100vh;">
    <div style="width: 500px; height: 700px; background-color: #efefef; border-radius: 10px; overflow: hidden;">
        <div style="width: 100%; height: 500px; overflow-x: hidden; overflow-y: scroll;">
            <div style="padding: 10px;">
                <div id="messageOutput"></div>
            </div>
        </div>
        <div style="width: 100%; height: 200px; display: flex;">
            <div style="flex-grow: 1; margin: 10px;">
                <textarea id="messageInput"
                          style="width: 80%; height: 90%; padding: 10px; background: none;"></textarea>
            </div>
            <div style="width: 100px;">
                <button onclick="openSocketConn()">打开连接</button>
                <button onclick="doCloseConn()">断开连接</button>
                <button onclick="doSendMessageText()">发送消息</button>
                <button onclick="doClearMessage()">清空消息</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function openSocketConn() {
        $WebSocketHttp.openConnection("ws://127.0.0.1:8080/websocket/http", function () {
            $WebSocketHttp.registerRequestHandlerFunction("Chat", "Room", function (response) {
                let cv = document.getElementById("messageOutput").innerText;
                cv = cv + "\n\n" + response.body
                document.getElementById("messageOutput").innerText = cv
            })
            alert("连接打开完成")
        })
    }

    function doCloseConn() {
        $WebSocketHttp.closeConnection(1000, '主动关闭')
        alert("连接关闭完成")
    }

    function doSendMessageText() {
        const message = document.getElementById("messageInput").value;
        $WebSocketHttp.sendTextMessage("Chat", "Room", message, function (response, ws) {
            console.log("doSendMessageText", response)
        })
    }

    function doClearMessage() {
        document.getElementById("messageOutput").innerText = ""
    }
</script>
</body>
</html>